<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SW 미래영재 컴퓨터학원</title>
  <link rel="icon" type="image/x-icon" href="/static/favicon.ico"/>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet"/>
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
  <script src="https://unpkg.com/feather-icons"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');
    body { font-family: 'Noto Sans KR', sans-serif; }
    .hero-gradient { background: linear-gradient(135deg, #6e8efb 0%, #a777e3 100%); }
    .card-hover { transition: all 0.3s ease; }
    .card-hover:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
    .k-pressable:active { transform: translateY(1px); }
    .ring-focus { box-shadow: 0 0 0 3px rgba(79,70,229,0.25); }

    /* --- Mobile booking fixes --- */
    #booking-modal { z-index: 2147483000; } /* Crisp 위로 */
    #booking-modal .scroll-area { -webkit-overflow-scrolling: touch; }

    /* iOS 주소창 높이 문제 대응: svh 지원 시 사용, 아니면 vh */
    @supports (height: 100svh) { .modal-vh { height: 90svh; } }
    @supports not (height: 100svh) { .modal-vh { height: 90vh; } }

    /* 안전영역 패딩 */
    :root { --sab: env(safe-area-inset-bottom, 0px); }
    #booking-modal .with-safe { padding-bottom: max(16px, var(--sab)); }

    /* iOS 입력 확대 방지 */
    #booking-modal input,
    #booking-modal select,
    #booking-modal textarea { font-size: 16px; }

    /* 캘린더/슬롯 터치 타겟 확대 */
    #calendar-grid button { min-height: 44px; }
    #slot-container button { min-height: 44px; }

    /* 작은 화면 여백 */
    @media (max-width: 640px) {
      #booking-modal .panel-pad { padding-left: 12px; padding-right: 12px; }
    }
  </style>
</head>
<body class="bg-gray-50">
  <!-- Navigation -->
  <nav class="bg-white shadow-sm">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between h-16">
        <div class="flex items-center">
          <div class="flex-shrink-0 flex items-center">
            <i data-feather="cpu" class="text-indigo-600"></i>
            <span class="ml-2 text-xl font-bold text-gray-900">SW 미래영재 컴퓨터학원</span>
          </div>
        </div>
        <div class="hidden md:ml-6 md:flex md:items-center md:space-x-8">
          <a href="#" class="text-gray-900 inline-flex items-center px-1 pt-1 border-b-2 border-indigo-500 text-sm font-medium">홈</a>
          <a href="#programs" class="text-gray-500 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 border-transparent hover:border-gray-300 text-sm font-medium">프로그램</a>
          <a href="#teachers" class="text-gray-500 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 border-transparent hover:border-gray-300 text-sm font-medium">강사진</a>
          <a href="#reviews" class="text-gray-500 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 border-transparent hover:border-gray-300 text-sm font-medium">수강후기</a>
          <a href="#" class="text-gray-500 hover:text-gray-700 inline-flex items-center px-3 py-1.5 border border-transparent text-sm font-medium open-chat">문의하기</a>
          <a href="#" class="text-indigo-600 hover:text-indigo-800 inline-flex items-center px-3 py-1.5 border border-indigo-200 rounded-full text-sm font-semibold open-booking">예약</a>
        </div>
        <div class="-mr-2 flex items-center md:hidden">
          <button type="button" class="inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-500" aria-controls="mobile-menu" aria-expanded="false">
            <i data-feather="menu"></i>
          </button>
        </div>
      </div>
    </div>
    <!-- Mobile menu -->
    <div class="md:hidden hidden" id="mobile-menu">
      <div class="pt-2 pb-3 space-y-1">
        <a href="#" class="bg-indigo-50 border-indigo-500 text-indigo-700 block pl-3 pr-4 py-2 border-l-4 text-base font-medium">홈</a>
        <a href="#programs" class="border-transparent text-gray-500 hover:bg-gray-50 hover:border-gray-300 hover:text-gray-700 block pl-3 pr-4 py-2 border-l-4 text-base font-medium">프로그램</a>
        <a href="#teachers" class="border-transparent text-gray-500 hover:bg-gray-50 hover:border-gray-300 hover:text-gray-700 block pl-3 pr-4 py-2 border-l-4 text-base font-medium">강사진</a>
        <a href="#reviews" class="border-transparent text-gray-500 hover:bg-gray-50 hover:border-gray-300 hover:text-gray-700 block pl-3 pr-4 py-2 border-l-4 text-base font-medium">수강후기</a>
        <a href="#" class="border-transparent text-gray-500 hover:bg-gray-50 hover:border-gray-300 hover:text-gray-700 block pl-3 pr-4 py-2 border-l-4 text-base font-medium open-chat">문의하기</a>
        <a href="#" class="border-transparent text-indigo-600 hover:bg-gray-50 hover:border-indigo-300 hover:text-indigo-700 block pl-3 pr-4 py-2 border-l-4 text-base font-medium open-booking">예약</a>
      </div>
    </div>
  </nav>

  <!-- Hero Section -->
  <div class="hero-gradient">
    <div class="max-w-7xl mx-auto py-16 px-4 sm:py-24 sm:px-6 lg:px-8 text-center">
      <h1 class="text-4xl font-extrabold tracking-tight text-white sm:text-5xl lg:text-6xl" data-aos="fade-down">
        코딩, 결과로 증명합니다
      </h1>
      <p class="mt-6 max-w-3xl mx-auto text-xl text-indigo-100" data-aos="fade-up" data-aos-delay="200">
        입문부터 실전 프로젝트·자격증까지 — 성장 경로가 보이는 SW 교육
      </p>
      <div class="mt-10 flex justify-center flex-wrap gap-3" data-aos="fade-up" data-aos-delay="400">
        <a href="#programs" class="inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-indigo-700 bg-white hover:bg-gray-50">
          프로그램 보기
        </a>
        <a href="#" class="inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-indigo-800 bg-opacity-60 hover:bg-opacity-70 open-chat">
          상담 연결
        </a>
        <a href="#" class="inline-flex items-center px-6 py-3 border border-indigo-200 text-base font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 open-booking">
          무료 체험 수업 예약
        </a>
      </div>
    </div>
  </div>

  <!-- Programs Section -->
  <div id="programs" class="py-12 bg-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center">
        <h2 class="text-3xl font-extrabold text-gray-900 sm:text-4xl" data-aos="fade-up">프로그램 안내</h2>
        <p class="mt-4 max-w-2xl text-xl text-gray-500 mx-auto" data-aos="fade-up" data-aos-delay="200">
          목표에 맞춘 코스 선택 → 단계별 학습 → 결과물과 자격증으로 마무리
        </p>
      </div>

      <div class="mt-16">
        <div class="grid grid-cols-1 gap-8 sm:grid-cols-2 lg:grid-cols-4">
          <!-- Program 1 -->
          <div class="pt-6" data-aos="fade-up" data-aos-delay="200">
            <div class="flow-root bg-gray-50 rounded-lg px-6 pb-8 h-full card-hover">
              <div class="-mt-6">
                <div class="flex items-center justify-center h-12 w-12 rounded-md bg-indigo-500 text-white mx-auto">
                  <i data-feather="award"></i>
                </div>
                <h3 class="mt-8 text-lg font-medium text-gray-900 text-center">IT·코딩 자격증</h3>
                <p class="mt-5 text-base text-gray-600">
                  기초 문법 → 유형별 풀이 루틴 → 모의고사로 합격까지 동행합니다. 정보처리기능사·COS 등 대비.
                </p>
              </div>
            </div>
          </div>
          <!-- Program 2 -->
          <div class="pt-6" data-aos="fade-up" data-aos-delay="300">
            <div class="flow-root bg-gray-50 rounded-lg px-6 pb-8 h-full card-hover">
              <div class="-mt-6">
                <div class="flex items-center justify-center h-12 w-12 rounded-md bg-indigo-500 text-white mx-auto">
                  <i data-feather="image"></i>
                </div>
                <h3 class="mt-8 text-lg font-medium text-gray-900 text-center">그래픽·영상 편집</h3>
                <p class="mt-5 text-base text-gray-600">
                  포토샵/일러스트레이터, 프리미어 프로로 포스터·썸네일·하이라이트 영상까지 직접 제작합니다.
                </p>
              </div>
            </div>
          </div>
          <!-- Program 3 -->
          <div class="pt-6" data-aos="fade-up" data-aos-delay="400">
            <div class="flow-root bg-gray-50 rounded-lg px-6 pb-8 h-full card-hover">
              <div class="-mt-6">
                <div class="flex items-center justify-center h-12 w-12 rounded-md bg-indigo-500 text-white mx-auto">
                  <i data-feather="code"></i>
                </div>
                <h3 class="mt-8 text-lg font-medium text-gray-900 text-center">파이썬·블록코딩</h3>
                <p class="mt-5 text-base text-gray-600">
                  블록코딩으로 개념을 잡고 파이썬으로 알고리즘·자동화·데이터 시각화까지 연결합니다.
                </p>
              </div>
            </div>
          </div>
          <!-- Program 4 -->
          <div class="pt-6" data-aos="fade-up" data-aos-delay="500">
            <div class="flow-root bg-gray-50 rounded-lg px-6 pb-8 h-full card-hover">
              <div class="-mt-6">
                <div class="flex items-center justify-center h-12 w-12 rounded-md bg-indigo-500 text-white mx-auto">
                  <i data-feather="cpu"></i>
                </div>
                <h3 class="mt-8 text-lg font-medium text-gray-900 text-center">피지컬컴퓨팅·아두이노</h3>
                <p class="mt-5 text-base text-gray-600">
                  센서·모터 제어로 IoT 기초를 익히고, 팀 프로젝트로 작품을 완성합니다.
                </p>
              </div>
            </div>
          </div>
        </div>

        <!-- Level Roadmap -->
        <div class="mt-12 bg-white rounded-lg shadow-sm p-6" data-aos="fade-up">
          <div class="text-center">
            <h3 class="text-xl font-medium text-gray-900">수준별 로드맵</h3>
            <div class="mt-6 grid grid-cols-1 md:grid-cols-3 gap-4">
              <div class="bg-indigo-50 p-4 rounded-lg">
                <h4 class="font-medium text-indigo-700">초등</h4>
                <p class="mt-2 text-sm text-gray-700">
                  게임·스토리 제작으로 재미있게 입문 → 피지컬컴퓨팅으로 불멍 LED·라인트레이서 구현
                </p>
              </div>
              <div class="bg-indigo-50 p-4 rounded-lg">
                <h4 class="font-medium text-indigo-700">중등</h4>
                <p class="mt-2 text-sm text-gray-700">
                  파이썬 기초·문제 해결력 강화 → 데이터 기초·자격증 대비로 실전 감각 업
                </p>
              </div>
              <div class="bg-indigo-50 p-4 rounded-lg">
                <h4 class="font-medium text-indigo-700">고등/일반</h4>
                <p class="mt-2 text-sm text-gray-700">
                  포트폴리오 프로젝트·영상편집·아두이노 심화 → 진로 코칭까지 연결
                </p>
              </div>
            </div>
          </div>
        </div>
        <!-- /Level Roadmap -->
      </div>
    </div>
  </div>

  <!-- Teachers Section -->
  <div id="teachers" class="py-16 bg-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center">
        <h2 class="text-3xl font-extrabold text-gray-900 sm:text-4xl" data-aos="fade-up">강사진</h2>
        <p class="mt-4 max-w-2xl text-xl text-gray-500 mx-auto" data-aos="fade-up" data-aos-delay="200">
          실전 중심 커리큘럼과 밀착 피드백으로 성장을 돕습니다
        </p>
      </div>

      <div class="mt-12 grid grid-cols-1 gap-8 sm:grid-cols-2 lg:grid-cols-3">
        <!-- Teacher 1 -->
        <div class="pt-6" data-aos="fade-up" data-aos-delay="200">
          <div class="flow-root bg-gray-50 rounded-lg px-6 pb-8 h-full card-hover">
            <div class="-mt-6 flex justify-center">
              <img class="h-32 w-32 rounded-full object-cover" src="https://i.pravatar.cc/200?img=12" alt="허지연 원장">
            </div>
            <div class="mt-4 text-center">
              <h3 class="text-lg font-medium text-gray-900">허지연 원장</h3>
              <p class="mt-1 text-sm text-indigo-600">컴퓨터 교육 · 커리큘럼 설계</p>
              <div class="mt-4 text-sm text-gray-600 space-y-2 text-left">
                <p>• 20+년 현장 강의 경험, 수준 진단→맞춤 학습 설계</p>
                <p>• 학습 동기 설계·습관 코칭으로 꾸준함 유지</p>
                <p>• 결석·지연 케어 프로세스로 진도 격차 최소화</p>
                <p>• 보호자와 주간 리포트로 투명한 소통</p>
              </div>
            </div>
          </div>
        </div>
        <!-- Teacher 2 -->
        <div class="pt-6" data-aos="fade-up" data-aos-delay="400">
          <div class="flow-root bg-gray-50 rounded-lg px-6 pb-8 h-full card-hover">
            <div class="-mt-6 flex justify-center">
              <img class="h-32 w-32 rounded-full object-cover" src="https://i.pravatar.cc/200?img=5" alt="이동욱 강사">
            </div>
            <div class="mt-4 text-center">
              <h3 class="text-lg font-medium text-gray-900">이동욱 강사</h3>
              <p class="mt-1 text-sm text-indigo-600">AI · 데이터 · 프로젝트 멘토링</p>
              <div class="mt-4 text-sm text-gray-600 space-y-2 text-left">
                <p>• KAIST 전기및전자공학부 학·석사</p>
                <p>• AI·데이터 분야 실무 및 연구 경험</p>
                <p>• 논문·특허 경력, 국제학회 발표 경험</p>
                <p>• 포트폴리오 프로젝트 전 과정 멘토링</p>
              </div>
            </div>
          </div>
        </div>
        <!-- (필요 시 더 추가) -->
      </div>
    </div>
  </div>

  <!-- Features Section -->
  <div id="reviews" class="py-12 bg-gray-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="lg:text-center">
        <h2 class="text-3xl font-extrabold text-gray-900 sm:text-4xl" data-aos="fade-up">SW 미래영재의 약속</h2>
        <p class="mt-4 max-w-2xl text-xl text-gray-500 lg:mx-auto" data-aos="fade-up" data-aos-delay="200">작은 반, 선명한 목표, 눈에 보이는 결과</p>
      </div>

      <div class="mt-16">
        <div class="space-y-10 md:space-y-0 md:grid md:grid-cols-2 md:gap-x-8 md:gap-y-10">
          <!-- Feature 1 -->
          <div class="flex" data-aos="fade-right" data-aos-delay="200">
            <div class="flex-shrink-0">
              <div class="flex items-center justify-center h-12 w-12 rounded-md bg-indigo-500 text-white">
                <i data-feather="users"></i>
              </div>
            </div>
            <div class="ml-4">
              <h3 class="text-lg leading-6 font-medium text-gray-900">8인 이하 집중 지도</h3>
              <p class="mt-2 text-base text-gray-600">질문이 바로 해결되는 밀착 수업으로 학습 효율을 끌어올립니다.</p>
            </div>
          </div>
          <!-- Feature 2 -->
          <div class="flex" data-aos="fade-left" data-aos-delay="400">
            <div class="flex-shrink-0">
              <div class="flex items-center justify-center h-12 w-12 rounded-md bg-indigo-500 text-white">
                <i data-feather="clipboard"></i>
              </div>
            </div>
            <div class="ml-4">
              <h3 class="text-lg leading-6 font-medium text-gray-900">주간 피드백 리포트</h3>
              <p class="mt-2 text-base text-gray-600">학습 진도·과제 현황을 정기 리포트로 공유해 신뢰를 높입니다.</p>
            </div>
          </div>
          <!-- Feature 3 -->
          <div class="flex" data-aos="fade-right" data-aos-delay="600">
            <div class="flex-shrink-0">
              <div class="flex items-center justify-center h-12 w-12 rounded-md bg-indigo-500 text-white">
                <i data-feather="monitor"></i>
              </div>
            </div>
            <div class="ml-4">
              <h3 class="text-lg leading-6 font-medium text-gray-900">프로젝트 중심 수업</h3>
              <p class="mt-2 text-base text-gray-600">실제로 작동하는 결과물로 이해를 공고히 하고 포트폴리오를 만듭니다.</p>
            </div>
          </div>
          <!-- Feature 4 -->
          <div class="flex" data-aos="fade-left" data-aos-delay="800">
            <div class="flex-shrink-0">
              <div class="flex items-center justify-center h-12 w-12 rounded-md bg-indigo-500 text-white">
                <i data-feather="bell"></i>
              </div>
            </div>
            <div class="ml-4">
              <h3 class="text-lg leading-6 font-medium text-gray-900">출결·진도 알림</h3>
              <p class="mt-2 text-base text-gray-600">출결·진도 이슈는 즉시 안내해 학습 공백을 최소화합니다.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- CTA Section -->
  <div class="bg-indigo-700">
    <div class="max-w-2xl mx-auto text-center py-16 px-4 sm:py-20 sm:px-6 lg:px-8">
      <h2 class="text-3xl font-extrabold text-white sm:text-4xl" data-aos="fade-up">
        <span class="block">지금, 아이의 첫 프로젝트를 시작하세요</span>
        <span class="block">무료 체험 수업 신청</span>
      </h2>
      <p class="mt-4 text-lg leading-6 text-indigo-200" data-aos="fade-up" data-aos-delay="200">
        상담부터 체험까지 간단히 진행됩니다. 채팅으로 바로 연결해 드립니다.
      </p>
      <div class="flex justify-center gap-3">
        <a href="#" class="mt-8 w-full inline-flex items-center justify-center px-5 py-3 border border-transparent text-base font-medium rounded-md text-indigo-600 bg-white hover:bg-indigo-50 sm:w-auto open-chat" data-aos="fade-up" data-aos-delay="400">
          채팅으로 상담하기
        </a>
        <a href="#" class="mt-8 w-full inline-flex items-center justify-center px-5 py-3 border border-indigo-200 text-base font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 sm:w-auto open-booking" data-aos="fade-up" data-aos-delay="450">
          체험 수업 예약
        </a>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="bg-gray-800">
    <div class="max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
      <div class="grid grid-cols-2 md:grid-cols-4 gap-8">
        <div>
          <h3 class="text-sm font-semibold text-gray-400 tracking-wider uppercase">프로그램</h3>
          <ul class="mt-4 space-y-4">
            <li><a href="#programs" class="text-base text-gray-300 hover:text-white">IT·코딩 자격증</a></li>
            <li><a href="#programs" class="text-base text-gray-300 hover:text-white">파이썬·블록코딩</a></li>
            <li><a href="#programs" class="text-base text-gray-300 hover:text-white">그래픽·영상 편집</a></li>
            <li><a href="#programs" class="text-base text-gray-300 hover:text-white">피지컬컴퓨팅·아두이노</a></li>
          </ul>
        </div>

        <div>
          <h3 class="text-sm font-semibold text-gray-400 tracking-wider uppercase">학원 정보</h3>
          <ul class="mt-4 space-y-4">
            <li><a href="https://naver.me/xoHigSrx" target="_blank" rel="noopener" class="text-base text-gray-300 hover:text-white">오시는 길</a></li>
            <li><a href="#" class="text-base text-gray-300 hover:text-white">운영 시간</a></li>
            <li><a href="#" class="text-base text-gray-300 hover:text-white">학원 소개</a></li>
          </ul>
        </div>

        <div>
          <h3 class="text-sm font-semibold text-gray-400 tracking-wider uppercase">지원</h3>
          <ul class="mt-4 space-y-4">
            <li><a href="#" class="text-base text-gray-300 hover:text-white">자주 묻는 질문</a></li>
            <li><a href="#" class="text-base text-gray-300 hover:text-white">수강료 안내</a></li>
            <li><a href="#" class="text-base text-gray-300 hover:text-white">장학 제도</a></li>
          </ul>
        </div>

        <div>
          <h3 class="text-sm font-semibold text-gray-400 tracking-wider uppercase">연락처</h3>
          <ul class="mt-4 space-y-4">
            <li class="text-base text-gray-300">
              <a href="tel:050714155007" class="hover:text-white">전화: 0507-1415-5007</a>
            </li>
            <li class="text-base text-gray-300">
              <a href="mailto:donguk9805@gmail.com" class="hover:text-white">이메일: donguk9805@gmail.com</a>
            </li>
            <li class="flex space-x-6 mt-4">
              <a href="#" class="text-gray-400 hover:text-white"><i data-feather="facebook"></i></a>
              <a href="#" class="text-gray-400 hover:text-white"><i data-feather="instagram"></i></a>
              <a href="#" class="text-gray-400 hover:text-white"><i data-feather="youtube"></i></a>
            </li>
          </ul>
        </div>
      </div>
      <div class="mt-8 border-t border-gray-700 pt-8 md:flex md:items-center md:justify-between">
        <div class="flex space-x-6 md:order-2">
          <a href="#" class="text-gray-400 hover:text-white"><i data-feather="message-square"></i></a>
          <a href="#" class="text-gray-400 hover:text-white"><i data-feather="mail"></i></a>
        </div>
        <p class="mt-8 text-base text-gray-400 md:mt-0 md:order-1">
          &copy; 2025 SW 미래영재 컴퓨터학원. All rights reserved.
        </p>
      </div>
    </div>
  </footer>

  <!-- ====== 예약 캘린더 모달 ====== -->
  <div id="booking-modal" class="fixed inset-0 z-50 hidden" aria-hidden="true">
    <div class="absolute inset-0 bg-gray-900/60 backdrop-blur-sm"></div>
    <div class="relative mx-auto max-w-5xl modal-vh mt-6 bg-white rounded-2xl shadow-xl overflow-hidden">
      <!-- header -->
      <div class="flex items-center justify-between px-6 py-4 border-b">
        <div class="flex items-center gap-3">
          <div class="h-10 w-10 rounded-xl bg-indigo-600 text-white flex items-center justify-center"><i data-feather="calendar"></i></div>
          <div>
            <h3 class="text-lg font-bold text-gray-900">무료 체험 수업 예약</h3>
            <p class="text-sm text-gray-500">3단계로 1분 만에 예약 완료</p>
          </div>
        </div>
        <button id="booking-close" class="p-2 rounded-lg hover:bg-gray-100" aria-label="닫기"><i data-feather="x"></i></button>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-3 h-[calc(90%-64px)]">
        <!-- left: steps -->
        <div class="lg:col-span-2 overflow-y-auto p-6 space-y-6 scroll-area panel-pad with-safe">
          <!-- Stepper -->
          <ol class="flex items-center text-sm text-gray-600">
            <li class="step-item flex items-center gap-2" data-step="1">
              <span class="step-badge h-6 w-6 rounded-full flex items-center justify-center bg-indigo-600 text-white text-xs font-bold">1</span>
              <span class="font-medium">프로그램/강사</span>
              <span class="mx-3 h-[1px] w-8 bg-gray-200 hidden sm:inline-block"></span>
            </li>
            <li class="step-item flex items-center gap-2" data-step="2">
              <span class="step-badge h-6 w-6 rounded-full flex items-center justify-center bg-gray-200 text-gray-600 text-xs font-bold">2</span>
              <span class="font-medium">날짜/시간</span>
              <span class="mx-3 h-[1px] w-8 bg-gray-200 hidden sm:inline-block"></span>
            </li>
            <li class="step-item flex items-center gap-2" data-step="3">
              <span class="step-badge h-6 w-6 rounded-full flex items-center justify-center bg-gray-200 text-gray-600 text-xs font-bold">3</span>
              <span class="font-medium">신청서</span>
            </li>
          </ol>

          <!-- Step 1 -->
          <section id="step-1" class="step-section">
            <div class="grid sm:grid-cols-2 gap-4">
              <div class="p-4 border rounded-xl">
                <label class="block text-sm font-medium text-gray-700 mb-1">프로그램</label>
                <select id="program-select" class="w-full rounded-lg border-gray-300 focus:border-indigo-500 focus:ring-indigo-500">
                  <option>IT·코딩 자격증</option>
                  <option>그래픽·영상 편집</option>
                  <option>파이썬·블록코딩</option>
                  <option>피지컬컴퓨팅·아두이노</option>
                </select>
                <p class="mt-2 text-xs text-gray-500">체험은 50분 수업 + 10분 상담으로 진행됩니다.</p>
              </div>
              <div class="p-4 border rounded-xl">
                <label class="block text-sm font-medium text-gray-700 mb-1">강사</label>
                <select id="teacher-select" class="w-full rounded-lg border-gray-300 focus:border-indigo-500 focus:ring-indigo-500">
                  <option value="허지연 원장">허지연 원장</option>
                  <option value="이동욱 강사">이동욱 강사</option>
                </select>
                <div class="mt-2 flex items-center gap-2 text-xs text-gray-500">
                  <i data-feather="clock" class="h-4 w-4"></i>
                  <span>가능 요일/시간은 선택한 강사 일정에 맞춰 표시됩니다.</span>
                </div>
              </div>
            </div>
            <div class="mt-4 flex items-center justify-between">
              <div class="text-sm text-gray-500">예약 가능 기간: <span id="range-label"></span></div>
              <button id="to-step-2" class="k-pressable inline-flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">
                <i data-feather="arrow-right"></i><span>다음</span>
              </button>
            </div>
          </section>

          <!-- Step 2 -->
          <section id="step-2" class="step-section hidden">
            <div class="grid md:grid-cols-2 gap-6">
              <!-- Calendar -->
              <div class="border rounded-xl p-4">
                <div class="flex items-center justify-between mb-3">
                  <button id="prev-month" class="p-2 rounded-lg hover:bg-gray-100" aria-label="이전 달"><i data-feather="chevron-left"></i></button>
                  <div class="text-center">
                    <div id="month-label" class="text-lg font-semibold text-gray-900">YYYY년 MM월</div>
                    <div class="text-xs text-gray-500">원하는 날짜를 선택하세요</div>
                  </div>
                  <button id="next-month" class="p-2 rounded-lg hover:bg-gray-100" aria-label="다음 달"><i data-feather="chevron-right"></i></button>
                </div>
                <div class="grid grid-cols-7 text-xs font-medium text-gray-500 text-center">
                  <div>일</div><div>월</div><div>화</div><div>수</div><div>목</div><div>금</div><div>토</div>
                </div>
                <div id="calendar-grid" class="mt-1 grid grid-cols-7 gap-1 text-sm"></div>
                <div class="mt-3 text-xs text-gray-500 flex items-center gap-3">
                  <span class="inline-flex items-center gap-1"><span class="inline-block h-3 w-3 rounded-full bg-green-400/80"></span>여유</span>
                  <span class="inline-flex items-center gap-1"><span class="inline-block h-3 w-3 rounded-full bg-yellow-400/80"></span>보통</span>
                  <span class="inline-flex items-center gap-1"><span class="inline-block h-3 w-3 rounded-full bg-red-400/80"></span>거의 마감</span>
                </div>
              </div>
              <!-- Timeslots -->
              <div class="border rounded-xl p-4">
                <div class="flex items-center justify-between mb-3">
                  <div class="text-sm text-gray-500">선택 날짜</div>
                  <div id="selected-date-label" class="text-base font-semibold text-gray-900">-</div>
                </div>
                <div id="slot-container" class="space-y-4">
                  <p class="text-sm text-gray-500">날짜를 먼저 선택해주세요.</p>
                </div>
              </div>
            </div>
            <div class="mt-4 flex items-center justify-between">
              <button class="k-pressable inline-flex items-center gap-2 px-4 py-2 rounded-lg border hover:bg-gray-50" data-back>
                <i data-feather="arrow-left"></i><span>이전</span>
              </button>
              <button id="to-step-3" class="k-pressable inline-flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-40 disabled:cursor-not-allowed" disabled>
                <i data-feather="check"></i><span>시간 선택 완료</span>
              </button>
            </div>
          </section>

          <!-- Step 3 -->
          <section id="step-3" class="step-section hidden">
            <form id="booking-form" class="grid md:grid-cols-2 gap-4">
              <div class="col-span-2">
                <div class="p-4 bg-indigo-50 border border-indigo-100 rounded-xl text-sm text-indigo-900">
                  <div class="flex items-start gap-3">
                    <i data-feather="info" class="h-4 w-4 mt-0.5"></i>
                    <div>
                      <div><span class="font-semibold">확인</span>: <span id="summary-title">-</span></div>
                      <div class="text-indigo-700/80">예약 정보가 맞는지 확인해 주세요.</div>
                    </div>
                  </div>
                </div>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">학생 이름</label>
                <input required id="input-name" type="text" class="w-full rounded-lg border-gray-300 focus:border-indigo-500 focus:ring-indigo-500" placeholder="홍길동"/>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">학년</label>
                <select id="input-grade" class="w-full rounded-lg border-gray-300 focus:border-indigo-500 focus:ring-indigo-500">
                  <option>초등</option><option>중등</option><option>고등</option><option>일반</option>
                </select>
              </div>
              <div class="md:col-span-2">
                <label class="block text-sm font-medium text-gray-700 mb-1">연락처</label>
                <input required id="input-phone" type="tel" inputmode="numeric" pattern="[0-9\\-]{8,}" class="w-full rounded-lg border-gray-300 focus:border-indigo-500 focus:ring-indigo-500" placeholder="010-1234-5678"/>
              </div>
              <div class="md:col-span-2">
                <label class="block text-sm font-medium text-gray-700 mb-1">요청 사항 (선택)</label>
                <textarea id="input-notes" rows="3" class="w-full rounded-lg border-gray-300 focus:border-indigo-500 focus:ring-indigo-500" placeholder="배우고 싶은 목표나 진도, 기타 요청을 적어주세요."></textarea>
              </div>
              <div class="md:col-span-2 flex items-center gap-2 mt-2">
                <input id="sms-consent" type="checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded"/>
                <label for="sms-consent" class="text-sm text-gray-600">문자/카카오 알림 수신에 동의합니다.</label>
              </div>
              <div class="md:col-span-2 flex items-center justify-between mt-2">
                <button class="k-pressable inline-flex items-center gap-2 px-4 py-2 rounded-lg border hover:bg-gray-50" data-back>
                  <i data-feather="arrow-left"></i><span>이전</span>
                </button>
                <div class="flex items-center gap-3">
                  <a id="gcal-link" href="#" target="_blank" class="hidden px-3 py-2 text-sm border rounded-lg hover:bg-gray-50">Google 캘린더</a>
                  <a id="ics-link" href="#" download class="hidden px-3 py-2 text-sm border rounded-lg hover:bg-gray-50">.ics 다운로드</a>
                  <button id="submit-booking" type="submit" class="k-pressable inline-flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">
                    <i data-feather="calendar"></i><span>예약 확정</span>
                  </button>
                </div>
              </div>
            </form>
          </section>
        </div>

        <!-- right: summary -->
        <aside class="border-l p-6 bg-gray-50/70 overflow-y-auto scroll-area panel-pad with-safe">
          <div class="text-sm text-gray-500 mb-2">요약</div>
          <div class="p-4 bg-white border rounded-xl shadow-sm">
            <dl class="text-sm text-gray-700 space-y-2">
              <div class="flex justify-between"><dt class="text-gray-500">프로그램</dt><dd id="sum-program">-</dd></div>
              <div class="flex justify-between"><dt class="text-gray-500">강사</dt><dd id="sum-teacher">-</dd></div>
              <div class="flex justify-between"><dt class="text-gray-500">날짜</dt><dd id="sum-date">-</dd></div>
              <div class="flex justify-between"><dt class="text-gray-500">시간</dt><dd id="sum-time">-</dd></div>
              <div class="flex justify-between"><dt class="text-gray-500">소요</dt><dd>50분 수업 + 10분 상담</dd></div>
              <div class="flex justify-between"><dt class="text-gray-500">장소</dt><dd>경남 김해시 율하1로 102 경보코아 203호</dd></div>
            </dl>
          </div>
          <div class="mt-4 text-xs text-gray-500">
            * 예약 접수 후 채팅/문자로 확정 안내를 드립니다.<br/>
            * 사정상 변경이 필요한 경우 미리 연락 부탁드립니다.
          </div>
        </aside>
      </div>
    </div>

    <!-- toast -->
    <div id="toast" class="fixed left-1/2 -translate-x-1/2 bottom-6 with-safe hidden">
      <div class="px-4 py-2 bg-gray-900 text-white rounded-full shadow-lg text-sm">예약이 저장되었습니다</div>
    </div>
  </div>
  <!-- ====== /예약 모달 ====== -->

  <script>
    // --- Mobile menu toggle ---
    document.querySelector('button[aria-controls="mobile-menu"]').addEventListener('click', function() {
      const menu = document.getElementById('mobile-menu');
      menu.classList.toggle('hidden');
    });

    // --- Initialize AOS & icons ---
    AOS.init({ duration: 800, easing: 'ease-out-quad', once: true });
    feather.replace();

    // ===== Crisp 채팅 위젯 =====
    window.$crisp = window.$crisp || [];
    window.CRISP_WEBSITE_ID = "aa5eeb9f-4d45-4e94-bd7e-9669115e0d3d";
    (function () { var d = document, s = d.createElement("script"); s.src = "https://client.crisp.chat/l.js"; s.async = 1; d.getElementsByTagName("head")[0].appendChild(s); })();
    window.$crisp.push(["set", "locale", "ko"]);

    function bindChatOpener(){
      document.querySelectorAll('.open-chat').forEach(a=>{
        a.addEventListener('click', function(e){
          e.preventDefault();
          if (window.$crisp) { $crisp.push(["do", "chat:open"]); }
        });
      });
    }
    document.addEventListener('DOMContentLoaded', bindChatOpener);

    // ===== 예약 모달/캘린더 로직 =====
    const state = {
      program: 'IT·코딩 자격증',
      teacher: '허지연 원장',
      date: null,      // Date object
      time: null,      // 'HH:MM'
      rangeDays: 45,   // reservable window
      durationMin: 60, // 50 + 10
    };

    // Weekly availability by teacher (0=Sun..6=Sat)
    const availability = {
      "허지연 원장": {
        1: ['16:00','17:00'],              // Mon
        3: ['16:00','17:30'],              // Wed
        5: ['14:00','15:30','17:00'],      // Fri
        6: ['10:00','11:30']               // Sat
      },
      "이동욱 강사": {
        2: ['19:00','20:00'],              // Tue
        4: ['19:00','20:00'],              // Thu
        6: ['13:00','15:00','17:00']       // Sat
      }
    };

    // === API base (Apps Script Web App URL) ===
    const API_BASE = "https://script.google.com/macros/s/AKfycbwh3BgU60qpUXvWM9oD97G-ynVaRI49PbjzMvHi9gCdV3wvfTOzD2JdXM31xYjtBa1U/exec"; // <-- 여기를 네 URL로 교체

    // reserved cache: { 'YYYY-MM-DD': ['HH:MM', ...] }
    let reservedCache = {};

    // --- Utils ---
    const pad = n => String(n).padStart(2,'0');
    const dayK = d => ['일','월','화','수','목','금','토'][d];
    const fmtDate = dt => `${dt.getFullYear()}년 ${pad(dt.getMonth()+1)}월 ${pad(dt.getDate())}일 (${dayK(dt.getDay())})`;
    const ymd = dt => `${dt.getFullYear()}-${pad(dt.getMonth()+1)}-${pad(dt.getDate())}`;

    function toast(msg='완료되었습니다'){
      const t = document.getElementById('toast');
      t.querySelector('div').textContent = msg;
      t.classList.remove('hidden');
      setTimeout(()=>t.classList.add('hidden'), 1800);
    }

    // === Body scroll lock without jump ===
    let __lockScrollY = 0;
    function lockBody() {
      __lockScrollY = window.scrollY || 0;
      document.body.style.position = 'fixed';
      document.body.style.top = `-${__lockScrollY}px`;
      document.body.style.left = '0';
      document.body.style.right = '0';
      document.body.style.width = '100%';
    }
    function unlockBody() {
      document.body.style.position = '';
      document.body.style.top = '';
      document.body.style.left = '';
      document.body.style.right = '';
      document.body.style.width = '';
      window.scrollTo(0, __lockScrollY);
    }

    // --- Open/Close modal ---
    function openBooking(){
      document.getElementById('booking-modal').classList.remove('hidden');
      lockBody();
      feather.replace();
    }
    function closeBooking(){
      document.getElementById('booking-modal').classList.add('hidden');
      unlockBody();
    }
    document.querySelectorAll('.open-booking').forEach(a=>a.addEventListener('click', e => { e.preventDefault(); openBooking(); }));
    document.getElementById('booking-close').addEventListener('click', closeBooking);
    document.addEventListener('keydown', e => { if(e.key === 'Escape') closeBooking(); });

    // --- Stepper ---
    function setStep(step){
      document.querySelectorAll('.step-section').forEach((sec, idx)=>{
        sec.classList.toggle('hidden', (idx+1)!==step);
      });
      document.querySelectorAll('.step-item').forEach((el, idx)=>{
        const badge = el.querySelector('.step-badge');
        if(idx+1 <= step){
          badge.classList.remove('bg-gray-200','text-gray-600');
          badge.classList.add('bg-indigo-600','text-white');
        }else{
          badge.classList.add('bg-gray-200','text-gray-600');
          badge.classList.remove('bg-indigo-600','text-white');
        }
      });
      feather.replace();
    }

    // --- Range label ---
    function renderRangeLabel(){
      const start = new Date(); const end = new Date();
      end.setDate(end.getDate() + state.rangeDays - 1);
      document.getElementById('range-label').textContent =
        `${start.getFullYear()}.${pad(start.getMonth()+1)}.${pad(start.getDate())} ~ ${end.getFullYear()}.${pad(end.getMonth()+1)}.${pad(end.getDate())}`;
    }

    function inRange(dt){
      const s = new Date(); s.setHours(0,0,0,0);
      const e = new Date(); e.setHours(0,0,0,0); e.setDate(e.getDate()+state.rangeDays-1);
      const t = new Date(dt); t.setHours(0,0,0,0);
      return t>=s && t<=e;
    }

    // Fetch reserved slots for teacher in range
    async function loadReserved(teacher, fromYmd, toYmd){
      const url = `${API_BASE}?mode=reserved&teacher=${encodeURIComponent(teacher)}&from=${fromYmd}&to=${toYmd}`;
      try{
        const res = await fetch(url);
        const data = await res.json();
        reservedCache = data.ok ? (data.reserved || {}) : {};
      }catch(e){
        reservedCache = {}; // fail-open
      }
    }

    // month range helper
    function monthRangeYmd(dt){
      const first = new Date(dt.getFullYear(), dt.getMonth(), 1);
      const last  = new Date(dt.getFullYear(), dt.getMonth()+1, 0);
      const start = new Date(); start.setHours(0,0,0,0);
      const end = new Date(); end.setDate(end.getDate()+state.rangeDays-1);
      const s = new Date(Math.max(start, first));
      const e = new Date(Math.min(end, last));
      const _ymd = d => `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
      return {from: _ymd(s), to: _ymd(e)};
    }

    // get slots minus reserved
    function getSlotsForDate(dt){
      const teacherMap = availability[state.teacher] || {};
      const base = teacherMap[dt.getDay()] || [];
      const key = `${dt.getFullYear()}-${pad(dt.getMonth()+1)}-${pad(dt.getDate())}`;
      const reserved = reservedCache[key] || [];
      return base.filter(t => !reserved.includes(t));
    }

    // --- Calendar ---
    let calCursor = new Date(); calCursor.setDate(1);

    async function renderCalendar(){
      const monthLabel = document.getElementById('month-label');
      monthLabel.textContent = `${calCursor.getFullYear()}년 ${pad(calCursor.getMonth()+1)}월`;

      const grid = document.getElementById('calendar-grid');
      grid.innerHTML = '<div class="col-span-7 text-center text-sm text-gray-400 py-6">불러오는 중…</div>';

      const rng = monthRangeYmd(calCursor);
      await loadReserved(state.teacher, rng.from, rng.to);

      grid.innerHTML = '';

      const firstDay = new Date(calCursor);
      const startWeekday = firstDay.getDay();
      const lastDate = new Date(calCursor.getFullYear(), calCursor.getMonth()+1, 0).getDate();

      for(let i=0;i<startWeekday;i++){ grid.appendChild(document.createElement('div')); }

      for(let d=1; d<=lastDate; d++){
        const dt = new Date(calCursor.getFullYear(), calCursor.getMonth(), d);
        const inWin = inRange(dt);
        const slots = inWin ? getSlotsForDate(dt) : [];
        const level = slots.length>=3 ? 'easy' : slots.length===2 ? 'mid' : slots.length===1 ? 'tight' : 'none';

        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'relative p-2 rounded-lg text-center hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 min-h-[44px]';
        btn.disabled = !inWin || level==='none';
        btn.innerHTML = `
          <div class="text-sm ${btn.disabled?'text-gray-300':'text-gray-900'} font-medium">${d}</div>
          <div class="mt-1 h-1 rounded-full ${
            level==='easy'?'bg-green-400/80':
            level==='mid'?'bg-yellow-400/80':
            level==='tight'?'bg-red-400/80':'bg-gray-200'
          }"></div>
        `;
        if (btn.disabled) {
          btn.classList.add('opacity-40','cursor-not-allowed');
        } else {
          btn.addEventListener('click', ()=>{
            state.date = dt;
            document.getElementById('selected-date-label').textContent = fmtDate(dt);
            renderSlots(dt);
            grid.querySelectorAll('button').forEach(b=>b.classList.remove('ring-2','ring-indigo-500'));
            btn.classList.add('ring-2','ring-indigo-500');
          });
        }
        grid.appendChild(btn);
      }
    }

    // --- Slots ---
    function renderSlots(dt){
      const wrap = document.getElementById('slot-container');
      wrap.innerHTML = '';
      const slots = getSlotsForDate(dt);
      if(!slots.length){
        wrap.innerHTML = '<p class="text-sm text-gray-500">이 날짜는 선택한 강사의 가능한 시간이 없습니다.</p>';
        document.getElementById('to-step-3').disabled = true;
        return;
      }

      const now = new Date();
      const isToday = (new Date().toDateString() === dt.toDateString());

      const group = document.createElement('div');
      group.className = 'flex flex-col sm:flex-row flex-wrap gap-2';

      slots.forEach(t=>{
        const [hh,mm] = t.split(':').map(Number);
        const candidate = new Date(dt.getFullYear(), dt.getMonth(), dt.getDate(), hh, mm);
        const past = isToday && candidate < now;

        const b = document.createElement('button');
        b.type = 'button';
        b.className = 'px-3 py-2 rounded-lg border text-sm hover:bg-indigo-50 w-full sm:w-auto';
        b.textContent = t;
        if(past){
          b.classList.add('opacity-40','cursor-not-allowed');
        }else{
          b.addEventListener('click', ()=>{
            state.time = t;
            document.getElementById('sum-time').textContent = t;
            document.getElementById('to-step-3').disabled = false;
            group.querySelectorAll('button').forEach(x=>x.classList.remove('border-indigo-500','bg-indigo-50'));
            b.classList.add('border-indigo-500','bg-indigo-50');
          });
        }
        group.appendChild(b);
      });

      wrap.appendChild(group);
    }

    // --- Summary rendering ---
    function renderSummary(){
      document.getElementById('sum-program').textContent = state.program || '-';
      document.getElementById('sum-teacher').textContent = state.teacher || '-';
      document.getElementById('sum-date').textContent = state.date ? fmtDate(state.date) : '-';
      document.getElementById('sum-time').textContent = state.time || '-';
      const title = `${state.program} · ${state.teacher} · ${state.date?fmtDate(state.date):''} ${state.time||''}`.trim();
      document.getElementById('summary-title').textContent = title;
    }

    // --- ICS / Google Calendar helpers ---
    function toUTCISOStringKST(localDate, hhmm, durationMin){
      const [H,M] = hhmm.split(':').map(Number);
      const start = new Date(localDate.getFullYear(), localDate.getMonth(), localDate.getDate(), H, M, 0);
      const end = new Date(start.getTime() + durationMin*60000);
      const fmt = d => d.toISOString().replace(/[-:]/g,'').replace(/\.\d{3}Z/,'Z');
      return { dtStartZ: fmt(start), dtEndZ: fmt(end) };
    }

    function buildICS(summary, description, location, localDate, hhmm, durationMin){
      const {dtStartZ, dtEndZ} = toUTCISOStringKST(localDate, hhmm, durationMin);
      const uid = `swmirae-${Date.now()}@booking`;
      const ics =
`BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//SWMirae//Booking//KO
CALSCALE:GREGORIAN
METHOD:PUBLISH
BEGIN:VEVENT
UID:${uid}
DTSTAMP:${dtStartZ}
DTSTART:${dtStartZ}
DTEND:${dtEndZ}
SUMMARY:${summary}
DESCRIPTION:${description.replace(/\n/g,'\\n')}
LOCATION:${location}
END:VEVENT
END:VCALENDAR`;
      return 'data:text/calendar;charset=utf-8,' + encodeURIComponent(ics);
    }

    function buildGCalURL(summary, details, location, localDate, hhmm, durationMin){
      const {dtStartZ, dtEndZ} = toUTCISOStringKST(localDate, hhmm, durationMin);
      const base = 'https://calendar.google.com/calendar/render?action=TEMPLATE';
      const text = '&text=' + encodeURIComponent(summary);
      const dates = '&dates=' + dtStartZ + '/' + dtEndZ;
      const det = '&details=' + encodeURIComponent(details);
      const loc = '&location=' + encodeURIComponent(location);
      return base + text + dates + det + loc;
    }

    // Step navigation
    document.getElementById('to-step-2').addEventListener('click', async ()=>{
      setStep(2);
      renderRangeLabel();
      calCursor = new Date(); calCursor.setDate(1);
      await renderCalendar();
      document.getElementById('selected-date-label').textContent = '-';
      document.getElementById('slot-container').innerHTML = '<p class="text-sm text-gray-500">날짜를 먼저 선택해주세요.</p>';
      document.getElementById('to-step-3').disabled = true;
    });

    document.querySelectorAll('[data-back]').forEach(b=>b.addEventListener('click', (e)=>{
      e.preventDefault();
      const s3 = !document.getElementById('step-3').classList.contains('hidden');
      if(s3) setStep(2); else setStep(1);
    }));

    document.getElementById('to-step-3').addEventListener('click', ()=>{
      setStep(3);
      renderSummary();
      const loc = '경남 김해시 율하1로 102 경보코아 203호';
      const summary = `SW 미래영재 무료 체험 수업 - ${state.program} (${state.teacher})`;
      const details = `프로그램: ${state.program}\n강사: ${state.teacher}\n예약일: ${fmtDate(state.date)} ${state.time}\n소요: 50분 수업 + 10분 상담`;
      const icsUrl = buildICS(summary, details, loc, state.date, state.time, state.durationMin);
      const gUrl = buildGCalURL(summary, details, loc, state.date, state.time, state.durationMin);
      const icsA = document.getElementById('ics-link'); icsA.href = icsUrl; icsA.classList.remove('hidden');
      const gA = document.getElementById('gcal-link'); gA.href = gUrl; gA.classList.remove('hidden');
    });

    // Teacher / Program change
    document.getElementById('program-select').addEventListener('change', (e)=>{
      state.program = e.target.value;
      document.getElementById('sum-program').textContent = state.program;
    });
    document.getElementById('teacher-select').addEventListener('change', async (e)=>{
      state.teacher = e.target.value;
      document.getElementById('sum-teacher').textContent = state.teacher;
      state.date = null; state.time = null;
      document.getElementById('sum-date').textContent = '-';
      document.getElementById('sum-time').textContent = '-';
      if(!document.getElementById('step-2').classList.contains('hidden')){
        await renderCalendar();
        document.getElementById('selected-date-label').textContent = '-';
        document.getElementById('slot-container').innerHTML = '<p class="text-sm text-gray-500">날짜를 먼저 선택해주세요.</p>';
        document.getElementById('to-step-3').disabled = true;
      }
    });

    // Month navigation
    document.getElementById('prev-month').addEventListener('click', async ()=>{
      calCursor.setMonth(calCursor.getMonth()-1); await renderCalendar();
    });
    document.getElementById('next-month').addEventListener('click', async ()=>{
      calCursor.setMonth(calCursor.getMonth()+1); await renderCalendar();
    });

    // Submit booking (save to Apps Script / Sheets)
    document.getElementById('booking-form').addEventListener('submit', async (e)=>{
      e.preventDefault();
      if(!state.date || !state.time){ alert('날짜/시간을 선택해 주세요.'); return; }

      const payload = {
        mode: 'reserve',
        teacher: state.teacher,
        date: ymd(state.date),
        time: state.time,
        program: state.program,
        name: document.getElementById('input-name').value.trim(),
        grade: document.getElementById('input-grade').value,
        phone: document.getElementById('input-phone').value.trim(),
        notes: document.getElementById('input-notes').value.trim()
      };

      let data = {ok:false}; let resStatus = 500;
      try{
        const res = await fetch(API_BASE, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload) });
        resStatus = res.status;
        data = await res.json();
      }catch(_){ data = {ok:false}; }

      if (resStatus === 409 || data.error === 'CONFLICT') {
        alert('방금 다른 예약이 들어와서 이 시간은 마감되었습니다. 다시 선택해 주세요.');
        const rng = monthRangeYmd(calCursor);
        await loadReserved(state.teacher, rng.from, rng.to);
        renderSlots(state.date);
        return;
      }
      if (!data.ok) { alert('예약 저장 중 오류가 발생했습니다.'); return; }

      try{
        if(window.$crisp){
          const msg = `[예약요청]\n학생: ${payload.name} (${payload.grade})\n연락처: ${payload.phone}\n프로그램: ${payload.program}\n강사: ${payload.teacher}\n일시: ${fmtDate(state.date)} ${state.time}\n요청: ${payload.notes || '-'}`;
          $crisp.push(["do","message:send",["text", msg]]);
        }
      }catch(_){}

      toast('예약이 저장되었습니다');
      setTimeout(closeBooking, 800);
    });

    // 폼 포커스 시 가려짐 완화
    document.querySelectorAll('#booking-form input, #booking-form textarea, #booking-form select')
      .forEach(el=>{
        el.addEventListener('focus', ()=>{
          setTimeout(()=> el.scrollIntoView({ block: 'center', behavior: 'smooth' }), 50);
        });
      });

    // Initialize summary labels
    document.getElementById('sum-program').textContent = state.program;
    document.getElementById('sum-teacher').textContent = state.teacher;
    renderRangeLabel();
  </script>
</body>
</html>
